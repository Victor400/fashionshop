{% extends "base.html" %}
{% load static %}

{% block title %}{{ p.name }} | FashionShop{% endblock %}

{% block content %}
<div class="container mt-4 pt-2 mt-lg-5 pt-lg-4">
  <!-- Breadcrumb -->
  <nav aria-label="breadcrumb" class="mb-3">
    <ol class="breadcrumb bg-transparent p-0 mb-0">
      <li class="breadcrumb-item">
        <a href="{% url 'catalog:product_list' %}">Products</a>
      </li>
      {% if p.category %}
      <li class="breadcrumb-item">
        <a href="{% url 'catalog:product_list' %}?cat={{ p.category.slug }}">
          {{ p.category.display_name|default:p.category.name }}
        </a>
      </li>
      {% endif %}
      <li class="breadcrumb-item active" aria-current="page">{{ p.name }}</li>
    </ol>
  </nav>

  <div class="row">
    <!-- Image -->
    <div class="col-md-6 mb-4">
      <div class="border rounded p-2 bg-white product-detail-media">
        <img
          class="img-fluid d-block mx-auto"
          alt="{{ p.name }}"
          src="{% static 'catalog/img/products/' %}{{ p.sku|lower }}.jpg">
      </div>
    </div>

    <!-- Details -->
    <div class="col-md-6">
      <div class="d-flex align-items-start justify-content-between">
        <h1 class="h3 mb-2">{{ p.name }}</h1>

        {% if request.user.is_staff %}
          <div class="btn-group">
            <a href="{% url 'catalog:product_update' p.slug %}" class="btn btn-outline-dark btn-sm">Edit</a>
            <a href="{% url 'catalog:product_delete' p.slug %}" class="btn btn-outline-danger btn-sm">Delete</a>
          </div>
        {% endif %}
      </div>

      <div class="mb-2">
        <span class="h4 mb-0">Â£{{ p.price|floatformat:2 }}</span>
      </div>

      <ul class="list-unstyled text-muted mb-3">
        {% if p.brand %}<li><strong class="text-dark">Brand:</strong> {{ p.brand.name }}</li>{% endif %}
        {% if p.category %}<li><strong class="text-dark">Category:</strong> {{ p.category.display_name|default:p.category.name }}</li>{% endif %}
        <li><strong class="text-dark">SKU:</strong> {{ p.sku }}</li>
        <li>
          <strong class="text-dark">Stock:</strong>
          {% if p.stock > 0 %}
            In stock ({{ p.stock }})
          {% else %}
            <span class="text-danger">Out of stock</span>
          {% endif %}
        </li>
      </ul>

      {% if p.description %}
        <p class="mb-4">{{ p.description|linebreaksbr }}</p>
      {% endif %}

      {% if p.stock > 0 %}
        <!-- Add to bag (POST) keeps you on this page via hidden next -->
        <form method="post" action="{% url 'catalog:add_to_bag' p.sku %}" class="d-inline">
          {% csrf_token %}
          <input type="hidden" name="next" value="{{ request.get_full_path|urlencode }}">
          <button type="submit" class="btn btn-dark btn-lg">Add to bag</button>
        </form>
        <a href="{% url 'orders:checkout_create' %}" class="btn btn-outline-dark btn-lg ml-2">Checkout</a>
      {% else %}
        <button class="btn btn-secondary btn-lg" disabled>Out of stock</button>
      {% endif %}
    </div>
  </div>
</div>
{% endblock %}
